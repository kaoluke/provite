<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ³¡æ³¡é£Ÿå…‰ - ç®¡ç†ä»‹é¢</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .section {
      background: #fff;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .section h2 {
      margin-top: 0;
      font-size: 1.4rem;
      border-bottom: 2px solid #eee;
      padding-bottom: 0.5rem;
    }
    .stock-item {
      margin-bottom: 1rem;
    }
    .stock-item label {
      display: inline-block;
      width: 150px;
      font-weight: bold;
    }
    .stock-item input {
      width: 60px;
      padding: 4px;
      text-align: center;
    }
    .stock-item button {
      padding: 4px 10px;
      margin-left: 10px;
      border: none;
      background-color: #4caf50;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    .order {
      border-bottom: 1px solid #ddd;
      padding: 1rem 0;
    }
    .order:last-child {
      border-bottom: none;
    }
    s {
      color: #999;
    }
  </style>
</head>
<body>

  <h1>æ³¡æ³¡é£Ÿå…‰ - ç®¡ç†ä»‹é¢</h1>

  <div class="section" id="stockSection">
    <h2>ğŸ“¦ åŸæ–™åº«å­˜ç®¡ç†</h2>
    <div id="stockContainer"></div>
  </div>

  <div class="section" id="ordersSection">
    <h2>ğŸ“‹ è¨‚å–®ç´€éŒ„</h2>
    <div id="ordersContainer"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBWfzmulutWwX9XZd__ZJJDH9ajq1rVYVM",
      authDomain: "times-a3946.firebaseapp.com",
      databaseURL: "https://times-a3946-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "times-a3946",
      storageBucket: "times-a3946.appspot.com",
      messagingSenderId: "168824083063",
      appId: "1:168824083063:web:123a72d9aa61ed62d5ec72"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function listenToStock() {
      db.ref("stock").on("value", snapshot => {
        const data = snapshot.val();
        const container = document.getElementById("stockContainer");
        container.innerHTML = "";

        for (const key in data) {
          const itemDiv = document.createElement("div");
          itemDiv.className = "stock-item";
          itemDiv.innerHTML = `
            <label>${key}ï¼š</label>
            <input type="number" id="stock_${key}" value="${data[key]}" min="0" />
            <button onclick="updateStock('${key}')">æ›´æ–°</button>
          `;
          container.appendChild(itemDiv);
        }
      });
    }

    function updateStock(key) {
      const val = parseInt(document.getElementById(`stock_${key}`).value) || 0;
      db.ref("stock/" + key).set(val, err => {
        if (!err) {
          alert(`${key} å·²æ›´æ–°ç‚º ${val}`);
        } else {
          alert("æ›´æ–°å¤±æ•—ï¼");
        }
      });
    }

    function listenToOrders() {
      db.ref("orders").on("value", snapshot => {
        const container = document.getElementById("ordersContainer");
        container.innerHTML = "";

        snapshot.forEach(child => {
          const data = child.val();
          const fried = data.main_fried || 0;
          const tofu = data.side_tofu || 0;
          const hotdog = data.side_hotdog || 0;
          const sprite = data.drink_sprite || 0;
          const coke = data.drink_coke || 0;

          const original = (fried + tofu + hotdog + sprite + coke) * 40;

          let discount = 0;
          if (fried > 0 && (tofu + hotdog) > 0 && (sprite + coke) > 0) {
            discount += 10;
          }

          const orderTime = new Date(data.time);
          const deadline = new Date("2025-06-04T00:00:00");
          if (orderTime < deadline) {
            discount += 10;
          }

          const finalTotal = original - discount;

          const orderDiv = document.createElement("div");
          orderDiv.className = "order";

          orderDiv.innerHTML = `
            ğŸ§‘ å§“åï¼š${data.name || "æœªå¡«å¯«"}<br/>
            ğŸ•’ æ™‚é–“ï¼š${orderTime.toLocaleString("zh-TW")}<br/>
            ğŸš ä¸»é£Ÿï¼šç‚’ç±³ç²‰ Ã— ${fried}<br/>
            ğŸ¥˜ å‰¯é£Ÿï¼šè±†å¹² Ã— ${tofu}ã€ç†±ç‹— Ã— ${hotdog}<br/>
            ğŸ¥¤ é£²æ–™ï¼šåŠ æª¸é›ªç¢§ Ã— ${sprite}ã€æ¢…å­å¯æ¨‚ Ã— ${coke}<br/>
            ğŸ’° åŸåƒ¹ï¼š<s>${original} å…ƒ</s>ï¼ŒæŠ˜æ‰£å¾Œï¼š${finalTotal} å…ƒ
          `;
          container.appendChild(orderDiv);
        });
      });
    }

    window.onload = () => {
      listenToStock();
      listenToOrders();
    };
  </script>

</body>
</html>
